---
title: UNIT2B(a)：資料檢視與繪圖
author: 中山大學管理學院 卓雍然
date: "`r Sys.time()`"
output: 
  html_document:
    highlight: pygments
    theme: flatly
    css: ../style.css
---

<hr>
基本的程式筆記設定，安裝、載入一些基本的套件
```{r results='hide', message=FALSE, warning=FALSE}
rm(list=ls(all=T))
knitr::opts_chunk$set(comment = NA)
knitr::opts_knit$set(global.par = TRUE)
options(scipen=20, digits=4, width=90)
if(!require(pacman)) install.packages("pacman")
pacman::p_load(magrittr)
```
以上這些程式碼請大家不要去改動<br><hr>


###【CASE 1】世界衛生組織資料集 WHO Dataset

##### 載入資料 Loading Data `read.csv()`
```{r}
WHO = read.csv("data/WHO.csv")
```

##### 資料結構 Data Structure `str()`
```{r}
str(WHO)
```

##### 資料顯示 Data Display `head()`, `tail()`
```{r}
head(WHO)
```

##### 資料總覽 Data Summary `summary()`
```{r}
summary(WHO)
```
<br>

##### 基本資料檢視 Basic Data Examination

**變數的(15歲以下人口比率)的平均值、標準差** `mean()`, `sd()` 
```{r}
mean(WHO$Under15) #只執行這行將游標放在後面按CTRL+ENTER
sd(WHO$Under15)
summary(WHO$Under15)
```

**15歲以下人口比率最低的國家** `which()`, `which.min()`, `which.max`
```{r}
which.min(WHO$Under15) #在第86格
``` 

```{r}
min(WHO$Under15) #和whichmin不同給的是數值
```


```{r}
WHO$Country[86] #排在86的國家 #下方出現的是類別的值
```

```{r}
WHO$Country[which.min(WHO$Under15)] #綜合以上
```

**15歲以下人口比率最高的國家**
```{r}
which.max(WHO$Under15)
```

```{r}
WHO$Country[124]
WHO$Country[which.max(WHO$Under15)]
```
<br>

##### 點狀圖 Scatterplot `plot()` 
觀察兩變數之間的關係 
```{r fig.height=4, fig.width=4}
par(cex=0.8, mar=c(4,4,2,1))
#r後面設定表格大小fig.height=4, fig.width=4 
#par內改變屬性 cex表示字的大小 mar圖四邊空間
plot(WHO$GNI, WHO$FertilityRate) #plot最常用(點狀圖:觀察兩變數之間關係) #生育率和國民所得之間的關係
abline(v=10000, h=2.5, col='red') #輔助線
```


```{r fig.height=4, fig.width=4}
plot(WHO$GNI, WHO$FertilityRate)
```

##### 資料篩選 Subsetting `subset()`. `nrow()`
```{r}
Outliers = subset(WHO, GNI > 10000 & FertilityRate > 2.5) #命名為outliers
nrow(Outliers) #看outliers有多少行
Outliers[c("Country","GNI","FertilityRate")] #c裡面是欄位名稱索引
```

<br>

##### 分類計數功能 `table()`
計算各『類別』的數量
```{r}
table(WHO$Region) #region是類別欄位
```
<br>

##### 分類計數功能 `table()`
比較各『類別』的數量
```{r}
par(mar=c(12,3,4,2),cex=0.8) #mar四圖邊(下左上右)
table(WHO$Region) %>% barplot(las=2, main="No. Country in Each Region") 
#加%>% barplot會變成直條圖 
```
<br>

##### 直方圖 Histogram `hist()`
觀察『數量』的分布
```{r}
par(mar=c(4,3,4,2),cex=0.8)
hist(WHO$CellularSubscribers)
```

```{r}
par(mar=c(12,3,4,2),mfrow=c(1,2), cex=0.8)
table(WHO$Region) %>% barplot(las=2, main="No. Country in Each Region")
hist(WHO$CellularSubscribers)
#直條圖(左)用來比較類別大小 #直方圖(右)用來辨識數量分布
```

<p class="wwl">
<span style="font-size:24px">`r "\U1F4DD"` 學習重點：</span><br>
變數的分布：變數的「值」所出現的「頻率」<br>
&emsp; ■ 類別變數：`table(x) %>% barplot()`<br>
&emsp; ■ 連續變數：`summary(x)`：`hist()`<br>
</p class="wwl"><br>


##### 盒狀圖 Boxplot `boxplot`
比較各『類別』的『數量』分布
```{r fig.height=4.5, fig.width=8}
par(mar=c(10,3,4,2),mfrow=c(1,2), cex=0.8) #mfrow在一列畫兩個圖
boxplot(WHO$LifeExpectancy ~ WHO$Region) #(前放數量~後放類別變數)
boxplot(WHO$LifeExpectancy ~ WHO$Region, 
        las=2, main = "Life Expectancy of Countries by Region")
#圓圈是outliers #黑粗線是中位數 #盒狀圖可以看到全分布
```

##### 分類統計功能 `tapply()`
```{r}
tapply(WHO$Over60, WHO$Region, mean) #tapply(數值向量,類別向量) 
#每個區域超過60的平均值 #樞紐分析 #by region做over60的mean
```
mean of over60 by region

+ point1
+ point 3

```{r}
tapply(WHO$LiteracyRate, WHO$Region, min)
```
min of literacy rate by region
只要有一統計量是NA 預設值就會是NA
```{r}
tapply(WHO$LiteracyRate, WHO$Region, min, na.rm=TRUE) #na.rm缺項除外
```

<p class="wwl">
<span style="font-size:24px">`r "\U1F4DD"` 學習重點：</span><br>
&emsp; ■ 樞紐分析：比較各『類別』的『數量』分布<br>
&emsp; ■ `tapply(numeric, factor, function) 依`B`統計`A`的`C`<br>
&emsp; ■ 分布(Distribution) vs. 統計量(Statistics)<br>
</p class="wwl">

```{r fig.height=4.5, fig.width=8}
par(mar=c(10,3,4,2),mfrow=c(1,2), cex=0.8)
boxplot(WHO$LifeExpectancy ~ WHO$Region, 
        xlab = "", ylab = "Life Expectancy", las=2, 
        main = "Distribution of Life Expectancy by Regions")
tapply(WHO$LifeExpectancy, WHO$Region, mean, na.rm=TRUE) %>% 
  barplot(las=2, main = "Average Life Expectancy by Regions")
```
<br><br><hr>


###【CASE 2】食物成分資料 USDA Dataset

##### 載入、檢視資料 Video2 - Reading in the Dataset
```{r}
USDA = read.csv("data/USDA.csv")
summary(USDA)
```
<br>

##### 簡單資料分析 Video 3 - Basic Data Analysis
**鹽分含量：**  當資料很大的時候  `head()`, `range()`, `summary()`, `hist()`
```{r}
nrow(USDA)
```

```{r}
head(USDA$Sodium, 300)
```

```{r}
range(USDA$Sodium, na.rm=T) #最小和最大
```

```{r}
summary(USDA$Sodium)
```
只看SUMMARY對分布無感> 做直方圖

```{r fig.height=3, fig.width=8}
par(mar=c(4,4,4,2),mfrow=c(1,2),cex=0.8)
hist(USDA$Sodium)
hist(log(USDA$Sodium))
```

**鹽分含量最高的食物**
```{r}
# Finding the index of the food with highest sodium levels
which.max(USDA$Sodium)
# Get the name of the food with highest sodium levels
USDA$Description[265]
```

**高鹽食物**
```{r}
# Create a subset of the foods with sodium content above 10,000mg
HighSodium = subset(USDA, Sodium>10000)
# Count the number of rows, or observations
nrow(HighSodium)
# Output names of the foods with high sodium content
HighSodium$Description
```

**魚子醬** `match()`
```{r}
# Finding the index of CAVIAR in the dataset
match("CAVIAR", USDA$Description) 
which(USDA$Description == "CAVIAR") #假設知道名稱
# Find amount of sodium in caviar
USDA$Sodium[4154]
# Doing it in one command!
USDA$Sodium[match("CAVIAR", USDA$Description)]
```
1.2.行相同 3.4.行相同

**魚子醬的含鹽量**
```{r}
USDA$Sodium[ USDA$Description == "CAVIAR" ] 
```

**統計量**
```{r}
# Summary function over Sodium vector
summary(USDA$Sodium)
# Standard deviation
sd(USDA$Sodium, na.rm = TRUE)
```
<br>

##### 基本繪圖 Video 4 - Plots

**點狀圖(兩變數之間的關係)：蛋白質 vs. 脂肪**
```{r fig.height=4, fig.width=8}
par(mfrow=c(1,2),cex=0.8)
# Scatter Plots
plot(USDA$Protein, USDA$TotalFat)
# Add xlabel, ylabel and title
plot(USDA$Protein, USDA$TotalFat, 
     xlab="Protein", ylab = "Fat", 
     main = "Protein vs Fat", col = "red")
```

**直方圖：維他命C**
```{r fig.height=6, fig.width=8}
par(mfrow=c(2,2),cex=0.8) #2,2共4張圖

# Creating a histogram
hist(USDA$VitaminC, xlab = "Vitamin C (mg)", main = "Histogram of Vitamin C")

# Add limits to x-axis
hist(USDA$VitaminC, xlab = "Vitamin C (mg)", 
     main = "Histogram of Vitamin C", xlim = c(0,100)) #只想看0-100 Xlim表示x軸界線

# Specify breaks of histogram
hist(USDA$VitaminC, xlab = "Vitamin C (mg)", 
     main = "Histogram of Vitamin C", xlim = c(0,100), breaks=100) #變數範圍 breaks多切100格

hist(USDA$VitaminC, xlab = "Vitamin C (mg)", 
     main = "Histogram of Vitamin C", xlim = c(0,100), breaks=2000)
#變數範圍 breaks多切2000格
```

**盒狀圖：糖分**
```{r fig.height=3.5, fig.width=8}
par(mfrow=c(1,2),cex=0.8)
# Boxplots
boxplot(USDA$Sugar, ylab="Sugar (g)", main="Boxplot of Sugar")
hist(USDA$Sugar, xlab="Sugar (g)", ylab="", main="Histogram of Sugar")

```
直方圖跟盒狀圖相同意思
<br>

<p class="qiz">
<span style="font-size:24px">`r "\U1F5FF"` 討論問題：</span><br>
&emsp; ■ 盒狀圖和直方圖有何異同？<br>
#只看變數或類別分布:做直方圖 #盒狀圖可以看到各類別的全分布 
&emsp; ■  直方圖的Y軸應該用什麼標題呢？<br> 
#frequency
</p class="qiz">
<br><br><hr>


##### 定義新欄位 Video 5 - Adding a variable
**平均值分割(mean split)**
```{r}
# Creating a variable that takes value 1 if the food has higher sodium
HighSodium = as.numeric(USDA$Sodium > mean(USDA$Sodium, na.rm=TRUE))

# Adding the variable to the dataset
USDA$HighSodium = as.numeric(USDA$Sodium > mean(USDA$Sodium, na.rm=TRUE)) #+as.numeric true變1 false變0

# Similarly for HighProtein, HigCarbs, HighFat
USDA$HighCarbs = as.numeric(USDA$Carbohydrate > mean(USDA$Carbohydrate, na.rm=TRUE))

USDA$HighProtein = as.numeric(USDA$Protein > mean(USDA$Protein, na.rm=TRUE))

USDA$HighFat = as.numeric(USDA$TotalFat > mean(USDA$TotalFat, na.rm=TRUE))
```
<br>

**二維樞紐分析** 
`tapply(X, list(A,B), F)` 依`A`和`B`統計`X`的`F`
```{r}
tapply(USDA$Sugar, list(Carbs=USDA$HighCarbs, Fat=USDA$HighFat), mean, na.rm=T)
#給兩個向量list(Carbs=USDA$HighCarbs, Fat=USDA$HighFat) 樞紐分析 
#意思是: 依照高脂肪低脂肪高碳水低碳水中找出糖量的平均
```

##### 分類計數與分類統計量 Video 6 - Summary Tables
<p class="qiz">
<span style="font-size:24px">`r "\U1F5FF"` 練習：</span><br>
以下的運算式分別代表什麼意思 ...<br>
&emsp; ■ `table(USDA$HighSodium)`<br>
&emsp; ■ `table(USDA$HighSodium, USDA$HighFat)`<br>
&emsp; ■ `tapply(USDA$Iron, USDA$HighProtein, mean, na.rm=TRUE)`<br>
&emsp; ■ `tapply(USDA$VitaminC, USDA$HighCarbs, max, na.rm=TRUE)`<br>
&emsp; ■ `tapply(USDA$VitaminC, USDA$HighCarbs, summary, na.rm=TRUE)`<br>
</p class="qiz">

```{r}
table(USDA$HighSodium) #計算USDA中是高鹽食物和不是高鹽食物的數量
```

```{r}
table(USDA$HighSodium, USDA$HighFat) #列出USDA中是否為高鹽食物和是否為高脂肪食物的數量
```

```{r}
tapply(USDA$Iron, USDA$HighProtein, mean, na.rm=TRUE) #在USDA中根據蛋白質高低計算鐵質平均量,並且忽略遺漏值
```

```{r}
tapply(USDA$VitaminC, USDA$HighCarbs, max, na.rm=TRUE) #在USDA中根據碳水化合物e高低統計維他命C最大量,並且忽略遺漏值
```

```{r}
tapply(USDA$VitaminC, USDA$HighCarbs, summary, na.rm=TRUE) #在USDA中根據碳水化合物高低檢視維他命C的統計資料,並且忽略遺漏值
```
<br><br>

<p class="wwl">
<span style="font-size:24px">`r "\U1F4DD"` UNIT2B 學習重點：</span><br>
&emsp; ■ 資料檢視功能：<br>
&emsp; &emsp; § 資料結構：`str()`<br>
&emsp; &emsp; § 資料總覽：`summary()`<br>
&emsp; &emsp; § 資料顯示：`head()`, `tail()`<br>
&emsp; ■ 基本統計量(Statistics)函數：<br>
&emsp; &emsp; § `mean()`, `median()`, `sd()`, `max()`, `min()`<br>
&emsp; ■ 基本繪圖：圖形基本上是一種比較工具<br>
&emsp; &emsp; § 類別變數的分布：直條圖 `barplot()`<br>
&emsp; &emsp; § 數量變數的分布：直方圖 `hist()`<br>
&emsp; &emsp; § 比較各類別的數量分布：盒狀圖 `boxplot()`<br>
&emsp; &emsp; § 兩數量變數的關係：點狀圖 `plot()`<br>
&emsp; ■ 位置功能函數：<br>
&emsp; &emsp; § `which()`, `which.max()`, `which.min()`<br>
&emsp; ■ 最重要的兩個功能函數：<br>
&emsp; &emsp; § 計算各分類的數量 `table()`<br>
&emsp; &emsp; § 計算各分類的統計量(樞紐分析) `tapply()`<br>
</p class="wwl">

<br><br><br>





